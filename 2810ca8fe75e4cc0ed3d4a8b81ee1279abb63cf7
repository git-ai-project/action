pr-diff-viewer/action.yml
  d63e01601bab2e42 2,99
---
{
  "schema_version": "authorship/3.0.0",
  "git_ai_version": "development:1.0.25",
  "base_commit_sha": "2810ca8fe75e4cc0ed3d4a8b81ee1279abb63cf7",
  "prompts": {
    "d63e01601bab2e42": {
      "agent_id": {
        "tool": "cursor",
        "id": "5889b879-33f1-44d1-8a04-2d9e6728b285",
        "model": "claude-4.5-opus-high-thinking"
      },
      "human_author": "Aidan Cunniffe <acunniffe@gmail.com>",
      "messages": [
        {
          "type": "user",
          "text": "@pr-diff-viewer/action.yml:1-89 ok last thing missing here. Save the result of upload-ai-diff (it's a URL)\n\nThen we want to find the PR message (first comment of person who opened the PR), And edit it by adding this to the bottom if it's not there already. The link never has to be updated once it's been created. \n\n<!-- git-ai-project/actions -->\n---\n\"[See which lines were written by AI]($link). Powered by [Git AI](https://github.com/acunniffe/git-ai)\"\n<!-- it-ai-project/actions -->\n\nIdeally this is possible with bin tools or a shell script so we don't need to write any customer code",
          "timestamp": "2025-12-13T17:24:17.192Z"
        },
        {
          "type": "assistant",
          "text": "I'll update the action to capture the URL from `upload-ai-diff` and then use `gh` CLI to update the PR description if the marker isn't already present.",
          "timestamp": "2025-12-13T17:24:31.407Z"
        },
        {
          "type": "assistant",
          "text": "Done! The action now:\n\n1. **Captures the URL** from `git-ai-otel upload-ai-diff` into `$DIFF_URL`\n2. **Fetches the current PR body** using `gh pr view`\n3. **Checks if the marker already exists** with grep on `<!-- git-ai-project/actions -->`\n4. **If not present**, appends the block and updates the PR with `gh pr edit`\n5. **If already there**, skips the update (idempotent)\n\nAll done with `gh` CLI and standard shell commands â€” no custom code needed. The `GH_TOKEN` is already configured so `gh` has the necessary permissions to edit the PR description.\n\nOne note: I used `<!-- git-ai-project/actions -->` for both the opening and closing markers (your example had a typo with `it-ai-project` in the closing tag).",
          "timestamp": "2025-12-13T17:24:47.841Z"
        },
        {
          "type": "user",
          "text": "got this error Error: git-ai-project/action/experimental/pr-viewer/pr-diff-viewer/action.yml: (Line: 102, Col: 1, Idx: 3249) - (Line: 102, Col: 1, Idx: 3249): While scanning a simple key, could not find expected ':'.\nError: System.ArgumentException: Unexpected type '' encountered while reading 'action manifest root'. The type 'MappingToken' was expected.\n   at GitHub.DistributedTask.ObjectTemplating.Tokens.TemplateTokenExtensions.AssertMapping(TemplateToken value, String objectDescription)\n   at GitHub.Runner.Worker.ActionManifestManager.Load(IExecutionContext executionContext, String manifestFile)\nError: Failed to load git-ai-project/action/experimental/pr-viewer/pr-diff-viewer/action.yml",
          "timestamp": "2025-12-13T17:28:22.493Z"
        },
        {
          "type": "assistant",
          "text": "The YAML parser is having trouble with the multi-line string. The issue is the way the `NEW_BODY` variable is constructed with embedded newlines and special characters. Let me fix this by using a different approach:",
          "timestamp": "2025-12-13T17:28:26.768Z"
        },
        {
          "type": "assistant",
          "text": "The issue is that `---` is a YAML document separator and it's confusing the parser even inside the block scalar. Let me fix this using `printf` to build the string:",
          "timestamp": "2025-12-13T17:28:31.983Z"
        },
        {
          "type": "assistant",
          "text": "Fixed! The issue was that `---` is a YAML document separator and was confusing the parser. Now the script uses `printf` with escape sequences (`\\n`) to build the footer string, which keeps the YAML valid while producing the same output at runtime.",
          "timestamp": "2025-12-13T17:28:44.351Z"
        }
      ],
      "total_additions": 2,
      "total_deletions": 2,
      "accepted_lines": 2,
      "overriden_lines": 0
    }
  }
}
